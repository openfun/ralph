
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A learning events processor to feed your LRS">
      
      
        <meta name="author" content="Open FUN (France Universite Numerique)">
      
      
        <link rel="canonical" href="https://openfun.github.io/ralph/contribute/">
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../CHANGELOG/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Contribute - Ralph</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#contribute" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ralph" class="md-header__button md-logo" aria-label="Ralph" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ralph
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Contribute
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/openfun/ralph/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    openfun/ralph
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ralph" class="md-nav__button md-logo" aria-label="Ralph" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Ralph
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/openfun/ralph/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    openfun/ralph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          User guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../commands/" class="md-nav__link">
        Commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        Backends
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Learning event models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Learning event models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        Rationale
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/edx/" class="md-nav__link">
        Open edX events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/xapi/" class="md-nav__link">
        xAPI events
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Developer guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Developer guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Contribute
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Contribute
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ralphs_core" class="md-nav__link">
    Ralph's core
  </a>
  
    <nav class="md-nav" aria-label="Ralph's core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working_with_local_backends" class="md-nav__link">
    Working with local backends
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ralphs_tray" class="md-nav__link">
    Ralph's tray
  </a>
  
    <nav class="md-nav" aria-label="Ralph's tray">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create_a_local_k3d_cluster" class="md-nav__link">
    Create a local k3d cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap_an_arnold_project" class="md-nav__link">
    Bootstrap an Arnold project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare_working_namespace" class="md-nav__link">
    Prepare working namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy_code_repeat" class="md-nav__link">
    Deploy, code, repeat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perform_arnolds_operations" class="md-nav__link">
    Perform Arnold's operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop_k3d_cluster" class="md-nav__link">
    Stop k3d cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          About the project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          About the project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ralphs_core" class="md-nav__link">
    Ralph's core
  </a>
  
    <nav class="md-nav" aria-label="Ralph's core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working_with_local_backends" class="md-nav__link">
    Working with local backends
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ralphs_tray" class="md-nav__link">
    Ralph's tray
  </a>
  
    <nav class="md-nav" aria-label="Ralph's tray">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create_a_local_k3d_cluster" class="md-nav__link">
    Create a local k3d cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap_an_arnold_project" class="md-nav__link">
    Bootstrap an Arnold project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare_working_namespace" class="md-nav__link">
    Prepare working namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy_code_repeat" class="md-nav__link">
    Deploy, code, repeat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perform_arnolds_operations" class="md-nav__link">
    Perform Arnold's operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop_k3d_cluster" class="md-nav__link">
    Stop k3d cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="contribute">Contribute<a class="headerlink" href="#contribute" title="Permanent link">&para;</a></h1>
<h2 id="ralphs_core">Ralph&rsquo;s core<a class="headerlink" href="#ralphs_core" title="Permanent link">&para;</a></h2>
<p>To start playing with <code>ralph</code>, you should build it using the <code>bootstrap</code> Make target:</p>
<div class="highlight"><pre><span></span><code>$ make bootstrap
</code></pre></div>
<p>Once the project has been bootstrapped, you may want to edit generated <code>.env</code>
file to set up available backends parameters that will be injected in the
running container as environment variables to configure Ralph (see <a href="../backends/">backends
documentation</a>):</p>
<div class="highlight"><pre><span></span><code># Elasticsearch backend
RALPH_ES_HOSTS=http://elasticsearch:9200
RALPH_ES_INDEX=statements
RALPH_ES_TEST_HOSTS=http://elasticsearch:9200
RALPH_ES_TEST_INDEX=test-index

# [...]
</code></pre></div>
<blockquote>
<p>Note that lines starting with a <code>#</code> are considered as commented and thus will
have no effect while running Ralph.</p>
</blockquote>
<p>Now you can start playing the CLI:</p>
<div class="highlight"><pre><span></span><code>$ bin/ralph --help
</code></pre></div>
<p>To lint your code, either use the <code>lint</code> meta target or one of the linting tools we use:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run all linters</span>
$<span class="w"> </span>make<span class="w"> </span>lint

<span class="c1"># Run pylint</span>
$<span class="w"> </span>make<span class="w"> </span>lint-pylint

<span class="c1"># List available linters</span>
$<span class="w"> </span>make<span class="w"> </span><span class="nb">help</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>lint-
</code></pre></div>
<p>To run tests on your code, either use the <code>test</code> Make target or the
<code>bin/pytest</code> script to pass specific arguments to the test runner:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run all tests</span>
$<span class="w"> </span>make<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Run pytest with options</span>
$<span class="w"> </span>bin/pytest<span class="w"> </span>-x<span class="w"> </span>-k<span class="w"> </span>mixins

<span class="c1"># Run pytest with options and more debugging logs</span>
$<span class="w"> </span>bin/pytest<span class="w"> </span>-x<span class="w"> </span>-vvv<span class="w"> </span>-s<span class="w"> </span>--log-level<span class="o">=</span>DEBUG<span class="w"> </span>-k<span class="w"> </span>mixins
</code></pre></div>
<h3 id="working_with_local_backends">Working with local backends<a class="headerlink" href="#working_with_local_backends" title="Permanent link">&para;</a></h3>
<p>Not all backends are accessible in a local environment development; for now
only <code>elasticsearch</code> and <code>swift</code> services are accessible as docker containers
(see <code>docker-compose.yml</code> services).</p>
<p>To configure those backends, we provide default parameters in the <code>.env.dist</code>
template, you can copy/paste them in your <code>.env</code> file (and uncomment them so
that they are properly injected in running containers).</p>
<blockquote>
<p>In order to run the Elasticsearch backend locally on GNU/Linux operating
systems, ensure that your virtual memory limits are not too low and increase
them (temporally) if needed by typing this command from your terminal (as
<code>root</code> or using <code>sudo</code>):</p>
<p><code>sysctl -w vm.max_map_count=262144</code></p>
<p>Reference:
https://www.elastic.co/guide/en/elasticsearch/reference/master/vm-max-map-count.html</p>
</blockquote>
<p>Once configured, start available backends using:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>run-<span class="o">[</span>BACKEND<span class="o">]</span>
</code></pre></div>
<p>Substitute <code>[BACKEND]</code> by the backend name, <em>e.g.</em> <code>es</code> for Elasticsearch or
<code>swift</code> for OpenStack Swift:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Start Elasticsearch local backend</span>
$<span class="w"> </span>make<span class="w"> </span>run-es
<span class="c1"># Start Swift local backend</span>
$<span class="w"> </span>make<span class="w"> </span>run-swift
<span class="c1"># Start all local backends</span>
$<span class="w"> </span>make<span class="w"> </span>run-all
</code></pre></div>
<p>Now that you have started at least the <code>elasticsearch</code> and <code>swift</code> backends,
it&rsquo;s time to play with them:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Store a JSON file in the Swift backend</span>
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;id&quot;: 1, &quot;foo&quot;: &quot;bar&quot;}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>./bin/ralph<span class="w"> </span>write<span class="w"> </span>-b<span class="w"> </span>swift<span class="w"> </span>-f<span class="w"> </span>foo.json

<span class="c1"># Check that we have created a new JSON file in the Swift backend</span>
$<span class="w"> </span>bin/ralph<span class="w"> </span>list<span class="w"> </span>-b<span class="w"> </span>swift
foo.json

<span class="c1"># Read the content of the JSON file and index it in Elasticsearch</span>
$<span class="w"> </span>bin/ralph<span class="w"> </span><span class="nb">read</span><span class="w"> </span>-b<span class="w"> </span>swift<span class="w"> </span>foo.json<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bin/ralph<span class="w"> </span>write<span class="w"> </span>-b<span class="w"> </span>es

<span class="c1"># Check that we have properly indexed the JSON file in Elasticsearch</span>
$<span class="w"> </span>bin/ralph<span class="w"> </span><span class="nb">read</span><span class="w"> </span>-b<span class="w"> </span>es
<span class="o">{</span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s2">&quot;foo&quot;</span>:<span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="o">}</span>
</code></pre></div>
<h2 id="ralphs_tray">Ralph&rsquo;s tray<a class="headerlink" href="#ralphs_tray" title="Permanent link">&para;</a></h2>
<p>Ralph is distributed along with its tray (a deployable package for Kubernetes
clusters using <a href="https://github.com/openfun/arnold">Arnold</a>). If you intend to
work on this tray, please refer to Arnold&rsquo;s documentation first.</p>
<p>Dependencies:</p>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/">Kubectl</a> (&gt;<code>v.1.23.5</code>):
  This CLI is used to communicate with the running Kubernetes instance you
  will use.</li>
<li><a href="https://k3d.io/">k3d</a> (&gt;<code>v.5.0.0</code>): This tool is used to setup
  and run a lightweight Kubernetes cluster, in order to have a local
  environment (it is required to complete below&rsquo;s quickstart instructions to
  avoid depending on an existing Kubernetes cluster).</li>
<li><a href="https://curl.se/">curl</a> is required by Arnold&rsquo;s CLI.</li>
<li><a href="https://gnupg.org/">gnupg</a> to encrypt Ansible vaults passwords and
  collaborate with your team.</li>
</ul>
<h3 id="create_a_local_k3d_cluster">Create a local <code>k3d</code> cluster<a class="headerlink" href="#create_a_local_k3d_cluster" title="Permanent link">&para;</a></h3>
<p>To create (or run) a local kubernetes cluster, we use <code>k3d</code>. The cluster&rsquo;s
bootstrapping should be run <em>via</em>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>k3d-cluster
</code></pre></div>
<blockquote>
<p>Running a k3d-cluster locally supposes that the 80 and 443 ports of your
machine are available, so that the ingresses created for your project
responds properly. If one or both ports are already used by another service
running on your machine, the <code>make k3d-cluster</code> command may fail.</p>
</blockquote>
<p>You can check that your cluster is running using the <code>k3d cluster</code> command:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>k3d<span class="w"> </span>cluster<span class="w"> </span>list
NAME<span class="w">     </span>SERVERS<span class="w">   </span>AGENTS<span class="w">   </span>LOADBALANCER
ralph<span class="w">    </span><span class="m">1</span>/1<span class="w">       </span><span class="m">0</span>/0<span class="w">      </span><span class="nb">true</span>
</code></pre></div>
<p>As you can see, we are running a single node cluster called <code>ralph</code>.</p>
<h3 id="bootstrap_an_arnold_project">Bootstrap an Arnold project<a class="headerlink" href="#bootstrap_an_arnold_project" title="Permanent link">&para;</a></h3>
<p>Once your Kubernetes cluster is running, you need to create a standard Arnold
project describing applications and environments you need to deploy:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>arnold-bootstrap
</code></pre></div>
<p>Once bootstrapped, Arnold should have created a <code>group_vars</code> directory
containing the following files:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>group_vars
group_vars
├──<span class="w"> </span>common
└──<span class="w"> </span>customer
<span class="w">    </span>└──<span class="w"> </span>ralph
<span class="w">        </span>├──<span class="w"> </span>development
<span class="w">        </span>│<span class="w">   </span>├──<span class="w"> </span>main.yml
<span class="w">        </span>│<span class="w">   </span>└──<span class="w"> </span>secrets
<span class="w">        </span>│<span class="w">       </span>├──<span class="w"> </span>databases.vault.yml
<span class="w">        </span>│<span class="w">       </span>├──<span class="w"> </span>elasticsearch.vault.yml
<span class="w">        </span>│<span class="w">       </span>└──<span class="w"> </span>ralph.vault.yml
<span class="w">        </span>└──<span class="w"> </span>main.yml

<span class="m">5</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">5</span><span class="w"> </span>files
</code></pre></div>
<p>To create the LRS credentials file, you need to provide a list of accounts
allowed to request the LRS in Ralph&rsquo;s vault:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Setup your kubernetes environment</span>
$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>.k3d-cluster.env.sh

<span class="c1"># Decrypt the vault</span>
$<span class="w"> </span>bin/arnold<span class="w"> </span>-d<span class="w"> </span>-c<span class="w"> </span>ralph<span class="w"> </span>-e<span class="w"> </span>development<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>-a<span class="w"> </span>ralph<span class="w"> </span>decrypt
</code></pre></div>
<p>Edit the vault file to add a new account for the <code>foo</code> user with the <code>bar</code>
password and a relevant scope:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># group_vars/customer/ralph/development/secrets/ralph.vault.yml</span>
<span class="c1">#</span>
<span class="c1"># [...]</span>
<span class="c1">#</span>
<span class="c1"># LRS</span>
<span class="nt">LRS_AUTH</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;foo&quot;</span>
<span class="w">    </span><span class="nt">hash</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$2b$12$lCggI749U6TrzK7Qyr7xGe1KVSAXdPjtkMew.BD6lzIk//T5YSb72&quot;</span>
<span class="w">    </span><span class="nt">scopes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;foo_scope&quot;</span>
</code></pre></div>
<p>The password hash has been generated using <code>bcrypt</code> as explained in the <a href="./api/#creating_a_credentials_file">API
user guide</a>.</p>
<p>And finally (re-)encrypt Ralph&rsquo;s vault:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Encrypt the vault</span>
$<span class="w"> </span>bin/arnold<span class="w"> </span>-d<span class="w"> </span>-c<span class="w"> </span>ralph<span class="w"> </span>-e<span class="w"> </span>development<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>-a<span class="w"> </span>ralph<span class="w"> </span>encrypt
</code></pre></div>
<p>You are now ready to create the related Kubernetes Secret while initializing
Arnold project in the next step.</p>
<h3 id="prepare_working_namespace">Prepare working namespace<a class="headerlink" href="#prepare_working_namespace" title="Permanent link">&para;</a></h3>
<p>You are now ready to create required Kubernetes objects to start working on
Ralph&rsquo;s deployment:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>arnold-init
</code></pre></div>
<p>At this point an Elasticsearch cluster should be running on your Kubernetes
cluster:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>-n<span class="w"> </span>development-ralph<span class="w"> </span>get<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>elasticsearch<span class="w"> </span>pod
NAME<span class="w">                                         </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
elasticsearch-node-0<span class="w">                         </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>69s
elasticsearch-node-1<span class="w">                         </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>69s
elasticsearch-node-2<span class="w">                         </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>69s
es-index-template-j-221010-09h25m24s-nx5qz<span class="w">   </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>49s
</code></pre></div>
<p>We are now ready to deploy Ralph to Kubernetes!</p>
<h3 id="deploy_code_repeat">Deploy, code, repeat<a class="headerlink" href="#deploy_code_repeat" title="Permanent link">&para;</a></h3>
<p>To test your local docker image, you need to build it and publish it to the
local kubernetes cluster docker registry using the <code>k3d-push</code> Makefile rule:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>k3d-push
</code></pre></div>
<blockquote>
<p>Note that each time you modify Ralph&rsquo;s application or its Docker image, you
will need to make this update.</p>
</blockquote>
<p>Now that your Docker image is published, it&rsquo;s time to deploy it!</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>arnold-deploy
</code></pre></div>
<p>To test this deployment, let&rsquo;s try to make an authenticated request to the LRS:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>curl<span class="w"> </span>-sLk<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--user<span class="w"> </span>foo:bar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;https://</span><span class="k">$(</span><span class="se">\</span>
<span class="w">        </span>kubectl<span class="w"> </span>-n<span class="w"> </span>development-ralph<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>get<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>ingress/ralph-app-current<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.rules[0].host}&#39;</span><span class="k">)</span><span class="s2">/whoami&quot;</span>
</code></pre></div>
<p>And why not send test statements from Potsie&rsquo;s repository:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>curl<span class="w"> </span>-sL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://github.com/openfun/potsie/raw/main/fixtures/elasticsearch/lrs.json.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>gunzip<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>jq<span class="w"> </span>-s<span class="w"> </span>.<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>sed<span class="w"> </span><span class="s2">&quot;s/@timestamp/timestamp/g&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>curl<span class="w"> </span>-sLk<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--user<span class="w"> </span>foo:bar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;https://</span><span class="k">$(</span><span class="se">\</span>
<span class="w">        </span>kubectl<span class="w"> </span>-n<span class="w"> </span>development-ralph<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>get<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>ingress/ralph-app-current<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.rules[0].host}&#39;</span><span class="k">)</span><span class="s2">/xAPI/statements/&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span>@-
</code></pre></div>
<blockquote>
<p>This example command requires <a href="https://stedolan.github.io/jq/"><code>jq</code></a> to
serialize the request payload (xAPI statements). When dealing with JSON data,
we strongly recommend to install it to manipulate them from the command line.</p>
</blockquote>
<h3 id="perform_arnolds_operations">Perform Arnold&rsquo;s operations<a class="headerlink" href="#perform_arnolds_operations" title="Permanent link">&para;</a></h3>
<p>If you want to run the <code>bin/arnold</code> script to run specific Arnold commands, you
must ensure that your environment is properly set and that Arnold runs in
development mode (<em>i.e.</em> using the <code>-d</code> flag):</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>.k3d-cluster.env.sh
$<span class="w"> </span>bin/arnold<span class="w"> </span>-d<span class="w"> </span>-c<span class="w"> </span>ralph<span class="w"> </span>-e<span class="w"> </span>development<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>-a<span class="w"> </span>ralph<span class="w"> </span>view
</code></pre></div>
<h3 id="stop_k3d_cluster">Stop <code>k3d</code> cluster<a class="headerlink" href="#stop_k3d_cluster" title="Permanent link">&para;</a></h3>
<p>When finished to work on the Tray, you can stop the <code>k3d</code> cluster using the <code>k3d-stop</code> helper:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>k3d-stop
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2020-present France Université Numérique
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>